commonfields:
  id: Cylance Protect v2
  version: -1
name: Cylance Protect v2
display: Cylance Protect v2
category: Endpoint
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAABRCAYAAAByintQAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0xpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzM0NkEwQTAzMUUxMTFFNTgyMzNCQTlGNzdBMTQyMjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzM0NkEwOUYzMUUxMTFFNTgyMzNCQTlGNzdBMTQyMjEiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmM5Y2E4NDJkLTc4NDgtMTE3OC05YWFmLWFhYjViOTEyZmE5OSIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmM5Y2E4NDJkLTc4NDgtMTE3OC05YWFmLWFhYjViOTEyZmE5OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrBGQ+IAAAqLSURBVHja7J0JjBRFFIZrBAHxxgOPiAdoPEBRo4KiQbyiqBjvA0TwvkURRSPeYgQjRMmKBx6IKIIKqIgRRUFAUFkEDyLqusSo8b5FjvX/6bfuZrI70zPVPT0z+3/JS83Mdnd1V1f9/ar6VW2qpqbGCSFEEqyjIhBCSICEEBIgIYSQAAkhJEBCCCEBEkJIgIQQQgIkhJAACSGEBEgIIQESQggJkBBCAiSEEBIgIYQESAghJEBCCAmQEEICJIQQEiAhhARICCEkQEKI8qW5z86pVCrUdhdXdtsYyRGwQ8w6wf6CzYO9BZsJm1PRefYa3RIhSguf/6yT8tq5EQGC4GxjQjMPolKF7+fg82NZDrcpjNttApsFm4t9/9LtFaJ8Bah5FCcAgWmHpLuJDtP29qdDYVU5HKozrK99Xonjzjcxopc0C4L0p263EOqC1QpPayRjYSfGcG7rwg4yux72J/K7DiI0SrdNiPLAdxB6ZEzi0xDrwx6ACB2m2yaEBIiclcA5n67bJoQEiKyXwDlvodsmhARICCEkQKKOdu3a6Z6KkqG5iuD/hstBbo5p7RJBuXxdXV09LESeRyJpg22fieD8Gew5HrYNPu+PY/6bYdsdkFzB7bHdgiK8F+zan+SCcI4/YJNwnlUR57EjkjNgLLeZOP40z+O1RHIrbAGONSnkPm3sHNrn6AywTFal/fY58h2bQ/ky390jqOs/wO6QAPlVHsYxzYB1iOiQjOgeliXPFkhegLXG5y5Ir0EFWu3RmF6B7Qr7CtYK9m+GXbrDBsB+Y4MpsnvBe/CqNcqFsL1hQ/H7RSifMRHl0ZOiBmtpPw3CbxPZKJHHqjwPuzXsOhfErE0KcQ57IHkDtmVERUeBHhsiX57nTHvQRoUEyJPRJj68MQ+7YJqIDz9l24AeCipDP3x8HHYlbGd8ZwP4LcfGxODP52GbuWBqywm5HqOIxIf18TkTn5dhT9pT+gbeI/x9Ea7t/Qg8xadMfEbAlsKGwE6mZ4G/90ceNTFfZ8rOgeIzGfZ0hgdGM9iGIQ77ZcjsR5n4zIY9CPMN7vWqa3ELUO1bslVFXOnZcI+C/QjricpXsOkfyGsC8q+ySngMbC6fzmG7G9j2XCQVLgjaZDeuH/b9p4QfBP1dEA3/ngnpKrvOP8yjvM8F0fY+HOuC6T4TcfwBdvzXWfYumAr0jQlenOxh1/kpu5r5er551HUKWS/YL1bXE39QxT1guZulC0N0Wf6GbZ5AGWwHS1nfveBzz5Anp5scAFtkT/v5qCjdslSkZrDh+PiIic/tsDNLWXxwPRsguc2+XpXWFWLA62ewg7FdL8+strd0Xr17sAzJ0eYNDEYeV8R8uTtauqBQ4mNsZm1+SbF4yXELEN1aV9F59kfWr28MPoHo9nZNsCxWJJUxKkM1EorOSy6Ic5qBRtAnw1PsRY4ZmdveG7sPibvbUAAGwdrCJuBa3kkrn5VIBtrXe6yrli8tLF2dlge9Lg58M6/7kMcpMV5rs3oP3iRYXSw3PW4B6npxZbcT7DPd2+oGtuENv9EFk1DbNNVBKDQAdjNYVvdaI3kSjWCojRfUig9XGZhj3YjvYT2w37hSv3a7rmvsIXB9I+UzBcmbNn5xUUz3YDqSc61djMN5dXeipAWIPAYR6gAv6DtrYH+n/f0y65MOa+o3g+44jE/6C10wbsbG+DwaQmvbZCdYR9gn7LalewolDLuQvMaRuKZMg6lXm6c8BGWyUUz3gG+SrrWu7WTks5dkIj4K8RaMA35TIEJdIEILkXKgcbz97SH7/K4L4jFE0AgeQsXnuMQkE+3Z+H4cfmd6IL5/VKpvuhrwfvZE0s88ujuzlEsltue6Uv1NnG+IqfyHI59t8fEq2DSWedRxSEVU/nygHR5i0/kogzmlKECEg9HjID69IELPIO1klYce2FOubrBa1DWCNyw+iONCjIV5ghUFv88ts0u9xwUvAYaEFFV210+DDUD5VGCf5TGdF72trVww+Xk6Xwwgr+/LsKpdbQ+AbMwIKVRFKUDOxi3uMOG5yQXLsp4nqckoQksZgOeCQfrNy+36LBKcIRBLXPBGL0yZfIv97rZuG+tT35jKvgb59LVyZ8Obiu89knhTGjMMbfgwxHbvlmoXrD6D4f18aF5Qbxe8CpX3k5nV5XhRNmdtuH0dmGMEMgfqL4D1wXFGYN+FcZyjBYvyzdhMF4RKTMT34z2ipYvxIbcYyeKk8k9i4uIYiM8+ECG628fDfpbGNEn6mhc8zd4+5dJo+CJjsHXdhsfcQFlPGSP0haUP138zKUpHgDg9gcur8nXzCxChthAhDrSe6pKLhxDJeD+trftE725gnofh9AXOY+uB4x0Tswh9Z11FTrw8x2UZLBfFJ0B0WRmUyPk3/O8XnPw5ESLUAiL0ukcljILaAL5WTei+J33NjPlh7M9oNO6P8xQFXsMA++obnBgmvyijpVda2iyh8i+aOaCFEiBWlCqKTr2LZ+Tv2gXmIUIcCHs8oTJYbg1yX1uSoynwlaWHFDpjlDGjnRn1/CvsFk9RYBzUBBfMrepfgPGSTNHStdMrfs+h/PfjtJoCFv+P5nV2jCuOqhiVcIyJC2MI0iOdz4MXVGn/6YJve/i6uaCBX6hUP+FmvGpPtyn4/Kjznw3/A2N2iliA5lgj6Irr5YzzKc5/wvAyXPOSENtxzRzO+xoU0WttxgNxftituJanLaI8zvoy3SYBs9zG2bIay01UyYwQx1iC/WqXGnkWn7kCgO9UoOXZVgrA339HXpz4zH8kMdnqum95cWjl7aQEaIWrW1OlIX4274fLHnRqZJsREKEPIEJzkV4e4mJ+iaFene+CMP8eZr6sSdC9DtOI+HaHY28c/O1j5ssH9CKzeD9srAy94JjKyIiu5Uscl8upsEvEt2MXFqD8xpoHcT/s5np/4nBCRcjD9DaxOsnMF0aQ7xRiu0tdMOm5u1kUpJISoKk2ttMY460xnp3lHPhUPBIiNAsi9Lmr+8eGDTE5hgr1NSpUZ6sUUayI+E2Ep7fYGlZlxNfMWfdcwOxMF4zJ+b7ZeS/ENvR4ODH5/kwrNubBUBfE6oSJVWF0OaPuX/Esv1Eov1kmHq3Mq5yK39eE3P9j7E8h4MqEHSIYDlkaMl/GUe3jol0RMX/l8vm3qpcsOngru5F7Z/AsOMiYbc7SSojP2lnKEKDnMojaMGw3yAkhigYfDfFSXYjBty5YQuMu13DAHMcV2oY41Lr1Pje0Qhv72EdJfIQoL7zfgkEUVsA4P6eLudfp+E4yZYh+R+Txmm6XEBKgxoSIYwD7ZvCGcqXW6znfoqaFEBKgUN7Qfi5YYjSvLqW8HiGaBrHEAdm6PxQhjv/kOoV/sI0tCSHKHK+3YKlU9je3XA3RBRHQe2URLU3wE6IESewtWEhvaJl1yRjr01C07dqxHt1GIeQBRe4BpXlDDPbj8gmcg8QQcK7yd7MGmYVomh6QlwAJIYQP66gIhBASICGEBEgIISRAQggJkBBCSICEEBIgIYSQAAkhJEBCCCEBEkJIgIQQQgIkhJAACSGEBEgIIQESQggJkBBCAiSEkAAJIYQESAghARJCCAmQEKJ8+U+AAQA2/2Q0HMSsQQAAAABJRU5ErkJggg==
description: Manage Endpoints using Cylance protect
configuration:
- display: Server URL
  name: server
  defaultvalue: https://protectapi.cylance.com
  type: 0
  required: true
- display: Application ID
  name: app_id
  defaultvalue: ""
  type: 0
  required: true
- display: Application Secret
  name: app_secret
  defaultvalue: ""
  type: 4
  required: true
- display: Tenant API Key
  name: tid
  defaultvalue: ""
  type: 4
  required: true
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |
    import jwt
    import uuid
    import requests
    import json
    import re
    from datetime import datetime, timedelta

    # CONSTANTS
    TOKEN_TIMEOUT = 300 # 5 minutes

    URI_AUTH = 'auth/v2/token'
    URI_DEVICES = 'devices/v2'
    URI_POLICIES = 'policies/v2'
    URI_ZONES = 'zones/v2'
    URI_THREATS = 'threats/v2'

    SCOPE_DEVICE_LIST = 'device:list'
    SCOPE_DEVICE_READ = 'device:read'
    SCOPE_DEVICE_UPDATE = 'device:update'
    SCOPE_DEVICE_THREATLIST = 'device:threatlist'
    SCOPE_POLICY_LIST = 'policy:list'
    SCOPE_ZONE_CREATE = 'zone:create'
    SCOPE_ZONE_LIST = 'zone:list'
    SCOPE_ZONE_READ = 'zone:read'
    SCOPE_ZONE_UPDATE = 'zone:update'
    SCOPE_THREAT_READ = 'threat:read'
    SCOPE_THREAT_DEVICELIST = 'threat:devicelist'

    # PREREQUISITES
    def load_server_url():
        ''' Cleans and loads the server url from the configuration '''
        url = demisto.params()['server']
        url = re.sub('/[\/]+$/', '', url)
        url = re.sub('\/$', '', url)
        return url


    def load_proxy():
        ''' Loads the system configured proxy if enabled in configuration '''
        proxy = {}
        if demisto.params()['proxy']:
            proxy['http'] = os.environ['http_proxy']
            proxy['https'] = os.environ['https_proxy']
        return proxy


    # GLOBALS
    APP_ID = demisto.params()['app_id']
    APP_SECRET = demisto.params()['app_secret']
    TID = demisto.params()['tid']
    SERVER_URL = load_server_url()
    PROXY = load_proxy()

    # HELPERS
    def generate_jwt_times():
        '''
        Generates the epoch time window in which the token will be valid
        Returns the current timestamp and the timeout timestamp (in that order)
        '''
        now = datetime.utcnow()
        timeout_datetime = now + timedelta(seconds=TOKEN_TIMEOUT)
        epoch_time = int((now - datetime(1970, 1, 1)).total_seconds())
        epoch_timeout = int((timeout_datetime - datetime(1970, 1, 1)).total_seconds())
        return epoch_time, epoch_timeout


    def api_call(uri, method = 'post', headers = {}, body = {}, params = {}):
        '''
        Makes an API call to the server URL with the supplied uri, method, headers, body and params
        '''
        url = '%s/%s' % (SERVER_URL, uri)
        res = requests.request(method, url, headers=headers, data=json.dumps(body), params=params)
        if res.status_code < 200 or res.status_code >= 300:
                raise Exception('Got status code ' + str(res.status_code) + ' with body ' + res.content + ' with headers ' + str(res.headers))
        return json.loads(res.text) if res.text else res.ok


    def get_authentication_token(scope = None):
        '''
        Generates a JWT authorization token with an optional scope and queries the API for an access token
        Returns the received API access token
        '''
        # Generate token ID
        token_id = str(uuid.uuid4())

        # Generate current time & token timeout
        epoch_time, epoch_timeout = generate_jwt_times()

        # Token claims
        claims = {
            'exp': epoch_timeout,
            'iat': epoch_time,
            'iss': 'http://cylance.com',
            'sub': APP_ID,
            'tid': TID,
            'jti': token_id
        }

        if scope:
            claims['scp'] = scope

        # Encode the token
        encoded = jwt.encode(claims, APP_SECRET, algorithm='HS256')
        payload = {'auth_token': encoded}
        headers = {'Content-Type': 'application/json; charset=utf-8'}

        res = api_call(method='post', uri=URI_AUTH, body=payload, headers=headers)
        return res['access_token']


    # FUNCTIONS
    def test():
        access_token = get_authentication_token()
        if not access_token:
            raise Exception('Unable to get access token')
        demisto.results('ok')


    def get_devices():
        page = demisto.args()['pageNumber'] if 'pageNumber' in demisto.args() else None
        page_size = demisto.args()['pageSize'] if 'pageSize' in demisto.args() else None

        devices = get_devices_request(page, page_size)

        # TODO: context

        # TODO: human readable

        demisto.results(devices)


    def get_devices_request(page = None, page_size = None):
        access_token = get_authentication_token(scope=SCOPE_DEVICE_LIST)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }

        params = {}
        if page:
            params['page'] = page
        if page_size:
            params['page_size'] = page_size

        res = api_call(uri=URI_DEVICES, method='get', headers=headers, params=params)
        return res


    def get_device():
        device_id = demisto.args()['id']
        device = get_device_request(device_id)

        # TODO: context

        # TODO: human readable

        demisto.results(device)


    def get_device_request(device_id):
        access_token = get_authentication_token(scope=SCOPE_DEVICE_READ)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }
        uri = '%s/%s' % (URI_DEVICES, device_id)
        res = api_call(uri=uri, method='get', headers=headers)
        return res


    def update_device():
        device_id = demisto.args()['id']

        # What details to update?
        name = demisto.args()['name'] if 'name' in demisto.args() else None
        policy_id = demisto.args()['policyId'] if 'policyId' in demisto.args() else None
        add_zones = demisto.args()['addZones'] if 'addZones' in demisto.args() else None
        remove_zones = demisto.args()['removeZones'] if 'removeZones' in demisto.args() else None

        res = update_device_request(device_id, name, policy_id, add_zones, remove_zones)

        # TODO: context

        # TODO: human readable

        demisto.results(res)


    def update_device_request(device_id, name = None, policy_id = None, add_zones = None, remove_zones = None):
        access_token = get_authentication_token(scope=SCOPE_DEVICE_UPDATE)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }

        body = {}
        if name:
            body['name'] = name
        if policy_id:
            body['policy_id'] = policy_id
        if add_zones:
            body['add_zone_ids'] = add_zones
        if remove_zones:
            body['remove_zone_ids'] = remove_zones

        # Do we have anything to update?
        if not body:
            raise Exception('No changes detected')

        uri = '%s/%s' % (URI_DEVICES, device_id)
        res = api_call(uri=uri, method='put', headers=headers, body=body)
        return res


    def get_device_threats():
        device_id = demisto.args()['id']
        page = demisto.args()['pageNumber'] if 'pageNumber' in demisto.args() else None
        page_size = demisto.args()['pageSize'] if 'pageSize' in demisto.args() else None

        threats = get_device_threats_request(device_id, page, page_size)

        # TODO: context

        # TODO: human readable

        demisto.results(threats)


    def get_device_threats_request(device_id, page = None, page_size = None):
        access_token = get_authentication_token(scope=SCOPE_DEVICE_THREATLIST)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }

        params = {}
        if page:
            params['page'] = page
        if page_size:
            params['page_size'] = page_size

        uri = '%s/%s/threats' % (URI_DEVICES, device_id)
        res = api_call(uri=uri, method='get', headers=headers, params=params)
        return res


    def get_policies():
        page = demisto.args()['pageNumber'] if 'pageNumber' in demisto.args() else None
        page_size = demisto.args()['pageSize'] if 'pageSize' in demisto.args() else None

        policies = get_policies_request(page, page_size)

        # TODO: context

        # TODO: human readable

        demisto.results(policies)


    def get_policies_request(page = None, page_size = None):
        access_token = get_authentication_token(scope=SCOPE_POLICY_LIST)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }

        params = {}
        if page:
            params['page'] = page
        if page_size:
            params['page_size'] = page_size

        res = api_call(uri=URI_POLICIES, method='get', headers=headers, params=params)
        return res


    def create_zone():
        name = demisto.args()['name']
        policy_id = demisto.args()['policy_id']
        criticality = demisto.args()['criticality']   # TODO: make it a list 'Low', 'Medium', 'High', should assert?

        res = create_zone_request(name, policy_id, criticality)

        # TODO: context

        # TODO: human readable

        demisto.results(res)


    def create_zone_request(name, policy_id, criticality):
        access_token = get_authentication_token(scope=SCOPE_ZONE_CREATE)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }
        body = {
            'name': name,
            'policy_id': policy_id,
            'criticality': criticality
        }
        res = api_call(uri=URI_ZONES, method='post', headers=headers, body=body)
        return res


    def get_zones():
        page = demisto.args()['pageNumber'] if 'pageNumber' in demisto.args() else None
        page_size = demisto.args()['pageSize'] if 'pageSize' in demisto.args() else None

        zones = get_zones_request(page, page_size)

        # TODO: context

        # TODO: human readable

        demisto.results(zones)


    def get_zones_request(page = None, page_size = None):
        access_token = get_authentication_token(scope=SCOPE_ZONE_LIST)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }

        params = {}
        if page:
            params['page'] = page
        if page_size:
            params['page_size'] = page_size

        res = api_call(uri=URI_ZONES, method='get', headers=headers, params=params)
        return res


    def get_zone():
        zone_id = demisto.args()['id']
        zone = get_zone_request(zone_id)

        # TODO: context

        # TODO: human readable

        demisto.results(zone)


    def get_zone_request(zone_id):
        access_token = get_authentication_token(scope=SCOPE_ZONE_READ)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }
        uri = '%s/%s' % (URI_ZONES, zone_id)
        res = api_call(uri=uri, method='get', headers=headers)
        return res


    def update_zone():
        zone_id = demisto.args()['id']

        # Get current zone and fill in reequires missing arguments
        currentZone = get_zone_request(zone_id)

        # What details to update?
        name = demisto.args()['name'] if 'name' in demisto.args() else currentZone['name']
        policy_id = demisto.args()['policy_id'] if 'policy_id' in demisto.args() else currentZone['policy_id']
        criticality = demisto.args()['criticality'] if 'criticality' in demisto.args() else currentZone['criticality']  # TODO: make it a list 'Low', 'Medium', 'High', should assert?

        res = update_zone_reqeust(zone_id, name, policy_id, criticality)

        # TODO: context

        # TODO: human readable

        demisto.results(res)


    def update_zone_reqeust(zone_id, name, policy_id, criticality):
        access_token = get_authentication_token(scope=SCOPE_ZONE_UPDATE)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }

        body = {}
        if name:
            body['name'] = name
        if policy_id:
            body['policy_id'] = policy_id
        if criticality:
            body['criticality'] = criticality

        # Do we have anything to update?
        if not body:
            raise Exception('No changes detected')

        uri = '%s/%s' % (URI_ZONES, zone_id)
        res = api_call(uri=uri, method='put', headers=headers, body=body)
        return res


    def get_threat():
        hash = demisto.args()['hash'] # TODO: document sha256 and also NOT md5
        threat = get_threat_request(hash)

        # TODO: context

        # TODO: human readable

        demisto.results(threat)


    def get_threat_request(hash):
        access_token = get_authentication_token(scope=SCOPE_THREAT_READ)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }
        uri = '%s/%s' % (URI_THREATS, hash)
        res = api_call(uri=uri, method='get', headers=headers)
        return res


    def get_threat_devices():
        threat_hash = demisto.args()['hash'] # TODO: document sha256 and also NOT md5
        page = demisto.args()['pageNumber'] if 'pageNumber' in demisto.args() else None
        page_size = demisto.args()['pageSize'] if 'pageSize' in demisto.args() else None

        threat = get_threat_devices_request(threat_hash, page, page_size)

        # TODO: context

        # TODO: human readable

        demisto.results(threat)


    def get_threat_devices_request(threat_hash, page = None, page_size = None):
        access_token = get_authentication_token(scope=SCOPE_THREAT_DEVICELIST)
        headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + access_token
        }

        params = {}
        if page:
            params['page'] = page
        if page_size:
            params['page_size'] = page_size

        uri = '%s/%s/devices' % (URI_THREATS, threat_hash)
        res = api_call(uri=uri, method='get', headers=headers, params=params)
        return res


    # EXECUTION
    if demisto.command() == 'test-module':
        test()
        exit(0)

    if demisto.command() == 'cylance-protect-get-devices':
        get_devices()
        exit(0)

    if demisto.command() == 'cylance-protect-get-device':
        get_device()
        exit(0)

    if demisto.command() == 'cylance-protect-update-devices':
        update_device()
        exit(0)

    if demisto.command() == 'cylance-protect-get-device-threats':
        get_device_threats()
        exit(0)

    if demisto.command() == 'cylance-protect-get-policies':
        get_policies()
        exit(0)

    if demisto.command() == 'cylance-protect-create-zone':
        create_zone()
        exit(0)

    if demisto.command() == 'cylance-protect-get-zones':
        get_zones()
        exit(0)

    if demisto.command() == 'cylance-protect-get-zone':
        get_zone()
        exit(0)

    if demisto.command() == 'cylance-protect-update-zone':
        update_zone()
        exit(0)

    if demisto.command() == 'cylance-protect-get-threat':
        get_threat()
        exit(0)

    if demisto.command() == 'cylance-protect-get-threat-devices':
        get_threat_devices()
        exit(0)
  type: python
  commands:
  - name: cylance-protect-get-devices
    arguments:
    - name: pageNumber
      description: 'Default: 1'
    - name: pageSize
      description: 'Default: 100'
    description: Allows a caller to request a page with a list of Console device resources
      belongings to a Tenant, sorted by registration (created) date in descending
      order (most recent device registered listed first)
  - name: cylance-protect-get-device
    arguments:
    - name: id
      required: true
      default: true
      description: The device ID
    description: Allows a caller to request a specific device resource belonging to
      a Tenant
  - name: cylance-protect-update-devices
    arguments:
    - name: id
      required: true
      default: true
      description: The device ID
    - name: name
      description: The device name
    - name: policyId
      description: The policy ID
    - name: addZones
      description: Zones to add
      isArray: true
    - name: removeZones
      description: Zones to remove
      isArray: true
    description: Allows a caller to update a specific Console device resource belonging
      to a Tenant
  - name: cylance-protect-get-device-threats
    arguments:
    - name: id
      required: true
      default: true
      description: The device ID
    - name: pageNumber
      description: 'Default: 1'
    - name: pageSize
      description: 'Default: 100, Max: 200'
    description: Allows a caller to request a page with a list of threats found on
      a specific device
  - name: cylance-protect-get-policies
    arguments:
    - name: pageNumber
      description: 'Default: 1'
    - name: pageItems
      description: 'Default: 100'
    description: Allows the caller to get a list of tenant policies
  - name: cylance-protect-create-zone
    arguments:
    - name: name
      required: true
      description: The name of the zone
    - name: policyId
      required: true
      description: The unique ID for the policy assigned to the Zone
    - name: criticality
      required: true
      auto: PREDEFINED
      predefined:
      - Low
      - Medium
      - High
      description: The criticality value of the Zone
    description: Create (add) a zone to your Console
  - name: cylance-protect-get-zones
    arguments:
    - name: pageNumber
      description: 'Default: 1'
    - name: pageItems
      description: 'Default: 100'
    description: Request zone information for your organization. This will return
      the top 100 records
  - name: cylance-protect-get-zone
    arguments:
    - name: id
      required: true
      default: true
      description: The zone ID
    description: Request zone information for a specific zone in your organization
  - name: cylance-protect-update-zone
    arguments:
    - name: id
      required: true
      default: true
      description: The zone ID
    - name: name
      description: The name of the zone
    - name: policyId
      description: The unique ID for the policy assigned to the Zone
    - name: criticality
      description: The criticality value of the Zone
    description: Update a zone in your organization
  - name: cylance-protect-get-threat
    arguments:
    - name: hash
      required: true
      default: true
      description: The SHA256 hash of the threat
    description: Request threat details for a specific threat
  - name: cylance-protect-get-threat-devices
    arguments:
    - name: hash
      required: true
      default: true
      description: The SHA256 hash of the threat
  dockerimage: demisto/cylance_protect_v2
